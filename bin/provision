#!/usr/bin/ruby
require 'yaml'
$: << File.join(File.dirname(__FILE__), "..", "lib")

configdir = File.join(File.dirname(__FILE__), "../lib/config")
target_dir = File.join(File.dirname(__FILE__), "../target")

require 'optparse'
require 'provision'
require 'provision/workqueue'

specs = YAML::load($stdin.read())

listener = NoopListener.new()
work_queue = Provision.new().work_queue( :worker_count => 4, :listener => listener)
work_queue.fill(specs)

work_queue.process()

if (listener.has_errors?)
  exit(1)
else
  exit(0)
end

